"use strict";(self.webpackChunkjira=self.webpackChunkjira||[]).push([[103],{5877:function(n,e,r){r.d(e,{r:function(){return c}});var t,i,o=r(5878),a=["title","titleId"];function u(){return u=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n},u.apply(this,arguments)}function d(n,e){if(null==n)return{};var r,t,i=function(n,e){if(null==n)return{};var r,t,i={},o=Object.keys(n);for(t=0;t<o.length;t++)r=o[t],e.indexOf(r)>=0||(i[r]=n[r]);return i}(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(t=0;t<o.length;t++)r=o[t],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(n,r)&&(i[r]=n[r])}return i}function s(n,e){var r=n.title,s=n.titleId,c=d(n,a);return o.createElement("svg",u({viewBox:"0 0 69 32",xmlns:"http://www.w3.org/2000/svg",focusable:"false","aria-hidden":"true",ref:e,"aria-labelledby":s},c),r?o.createElement("title",{id:s},r):null,t||(t=o.createElement("defs",null,o.createElement("linearGradient",{x1:"98.0308675%",y1:"0.160599572%",x2:"58.8877062%",y2:"40.7655246%",id:"uid5"},o.createElement("stop",{stopColor:"#0052CC",offset:"18%"}),o.createElement("stop",{stopColor:"#2684FF",offset:"100%"})))),i||(i=o.createElement("g",{stroke:"none",strokeWidth:1,fillRule:"nonzero"},o.createElement("path",{d:"M22.9366667,4 L11.41,4 C11.41,5.3800098 11.9582068,6.703498 12.934021,7.67931228 C13.9098353,8.65512657 15.2333235,9.20333333 16.6133333,9.20333333 L18.7366667,9.20333333 L18.7366667,11.2533333 C18.7385054,14.1244521 21.0655479,16.4514946 23.9366667,16.4533333 L23.9366667,5 C23.9366667,4.44771525 23.4889514,4 22.9366667,4 Z",fill:"currentColor"}),o.createElement("path",{d:"M17.2333333,9.74333333 L5.70666667,9.74333333 C5.70850536,12.6144521 8.03554792,14.9414946 10.9066667,14.9433333 L13.03,14.9433333 L13.03,17 C13.0336786,19.8711178 15.3622132,22.196669 18.2333333,22.1966667 L18.2333333,10.7433333 C18.2333333,10.1910486 17.7856181,9.74333333 17.2333333,9.74333333 Z",fill:"url(#uid5)"}),o.createElement("path",{d:"M11.5266667,15.4833333 L0,15.4833333 C3.51929402e-16,18.357055 2.32961169,20.6866667 5.20333333,20.6866667 L7.33333333,20.6866667 L7.33333333,22.7366667 C7.33516565,25.6051863 9.65815176,27.9311544 12.5266667,27.9366667 L12.5266667,16.4833333 C12.5266667,15.9310486 12.0789514,15.4833333 11.5266667,15.4833333 Z",fill:"url(#uid5)"}),o.createElement("path",{d:"M37.07,18.956 C37.07,20.646 36.394,21.842 34.418,21.842 C33.56,21.842 32.702,21.686 32,21.4 L32,23.662 C32.65,23.896 33.586,24.104 34.808,24.104 C38.032,24.104 39.41,21.946 39.41,18.8 L39.41,6.918 L37.07,6.918 L37.07,18.956 Z M42.894,7.568 C42.894,8.556 43.544,9.128 44.454,9.128 C45.364,9.128 46.014,8.556 46.014,7.568 C46.014,6.58 45.364,6.008 44.454,6.008 C43.544,6.008 42.894,6.58 42.894,7.568 Z M43.31,24 L45.546,24 L45.546,11 L43.31,11 L43.31,24 Z M48.926,24 L51.11,24 L51.11,16.33 C51.11,13.574 52.852,12.716 55.712,13.002 L55.712,10.818 C53.164,10.662 51.864,11.754 51.11,13.288 L51.11,11 L48.926,11 L48.926,24 Z M66.45,24 L66.45,21.66 C65.618,23.376 64.058,24.26 62.056,24.26 C58.598,24.26 56.856,21.322 56.856,17.5 C56.856,13.834 58.676,10.74 62.316,10.74 C64.214,10.74 65.67,11.598 66.45,13.288 L66.45,11 L68.686,11 L68.686,24 L66.45,24 Z M59.092,17.5 C59.092,20.62 60.34,22.18 62.654,22.18 C64.656,22.18 66.45,20.906 66.45,18.02 L66.45,16.98 C66.45,14.094 64.812,12.82 62.914,12.82 C60.392,12.82 59.092,14.484 59.092,17.5 Z",fillRule:"evenodd",fill:"inherit"}))))}var c=o.forwardRef(s);e.Z=r.p+"static/media/logo.a1c02bdc6c8da6d6bece64f8185177ad.svg"},5103:function(n,e,r){r.r(e),r.d(e,{default:function(){return Ee}});var t=r(5498),i=r(7688),o=r(5878),a=r(2189),u=r(759),d=r(5695),s=r(7852),c=r(7219),l=function(n){var e=(0,s.m)();return(0,c.useQuery)(["users",n],(function(){return e("users",{data:n})}))},f=r(8818),m=r(9677),p=r(1275),x=["value","onChange","defaultOptionName","options"],h=function(n){var e=n.value,r=n.onChange,t=n.defaultOptionName,i=n.options,o=(0,f.Z)(n,x);return(0,p.jsxs)(m.Z,(0,a.Z)((0,a.Z)({value:null!==i&&void 0!==i&&i.length?v(e):0,onChange:function(n){return null===r||void 0===r?void 0:r(v(n)||void 0)}},o),{},{children:[t?(0,p.jsx)(m.Z.Option,{value:0,children:t}):null,null===i||void 0===i?void 0:i.map((function(n){return(0,p.jsx)(m.Z.Option,{value:n.id,children:n.name},n.id)}))]}))},v=function(n){return isNaN(Number(n))?0:Number(n)},j=function(n){var e=l().data;return(0,p.jsx)(h,(0,a.Z)({options:e||[]},n))},Z=function(n){var e=n.param,r=n.setParam;return(0,p.jsxs)(u.Z,{style:{marginBottom:"2rem"},layout:"inline",children:[(0,p.jsx)(u.Z.Item,{children:(0,p.jsx)(d.Z,{type:"text",placeholder:"\u9879\u76ee\u540d",value:e.name,onChange:function(n){return r((0,a.Z)((0,a.Z)({},e),{},{name:n.target.value}))}})}),(0,p.jsx)(u.Z.Item,{children:(0,p.jsx)(j,{defaultOptionName:"\u8d1f\u8d23\u4eba",value:e.personId,onChange:function(n){return r((0,a.Z)((0,a.Z)({},e),{},{personId:n}))}})})]})},g=r(875),b=r(7315),y=r(5085),k=r(472),I=r(3168),C=r.n(I),L=r(1804),w=r(5175),E=["checked","onCheckChange"],O=function(n){var e=n.checked,r=n.onCheckChange,t=(0,f.Z)(n,E);return(0,p.jsx)(w.Z,(0,a.Z)({count:1,value:e?1:0,onChange:function(n){return null===r||void 0===r?void 0:r(Boolean(n))}},t))},T=r(5190),M=r(3289),P=r(1086),N=function(n){var e=n.fromId,r=n.type,t=n.toId,i=n.list,o=(0,T.Z)(i),a=o.findIndex((function(n){return n.id===e}));if(!t)return A((0,T.Z)(o),a,o.length-1);var u=o.findIndex((function(n){return n.id===t}));return("after"===r?A:S)((0,T.Z)(o),a,u)},S=function(n,e,r){var t=n[r],i=n.splice(e,1)[0],o=n.indexOf(t);return n.splice(o,0,i),n},A=function(n,e,r){var t=n[r],i=n.splice(e,1)[0],o=n.indexOf(t);return n.splice(o+1,0,i),n},F=function(n,e){var r=(0,c.useQueryClient)();return{onSuccess:function(){return r.invalidateQueries(n)},onMutate:function(t){return(0,P.Z)((0,M.Z)().mark((function i(){var o;return(0,M.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=r.getQueryData(n),r.setQueryData(n,(function(n){return e(t,n)})),i.abrupt("return",{previousItems:o});case 3:case"end":return i.stop()}}),i)})))()},onError:function(e,t,i){r.setQueryData(n,i.previousItems)}}},z=function(n){return F(n,(function(n,e){return(null===e||void 0===e?void 0:e.filter((function(e){return e.id!==n.id})))||[]}))},D=function(n){return F(n,(function(n,e){return(null===e||void 0===e?void 0:e.map((function(e){return e.id===n.id?(0,a.Z)((0,a.Z)({},e),n):e})))||[]}))},Q=function(n){return F(n,(function(n,e){return e?[].concat((0,T.Z)(e),[n]):[]}))},R=function(n){var e=(0,s.m)();return(0,c.useQuery)(["projects",n],(function(){return e("projects",{data:n})}))},Y=function(n){var e=(0,s.m)();return(0,c.useMutation)((function(n){return e("projects/".concat(n.id),{data:n,method:"PATCH"})}),D(n))},K=function(){var n=(0,s.m)(),e=(0,c.useQueryClient)();return(0,c.useMutation)((function(e){return n("projects",{data:e,method:"POST"})}),{onSuccess:function(){return e.invalidateQueries("projects")}})},W=function(n){var e=(0,s.m)();return(0,c.useQuery)(["project",{id:n}],(function(){return e("projects/".concat(n))}),{enabled:Boolean(n)})},B=r(7301),V=r(905),X=r(2800),H=function(n){var e=(0,L.lr)(),r=(0,i.Z)(e,1)[0],t=U();return[(0,o.useMemo)((function(){return n.reduce((function(n,e){return(0,a.Z)((0,a.Z)({},n),{},(0,V.Z)({},e,r.get(e)||""))}),{})}),[r]),function(n){return t(n)}]},U=function(){var n=(0,L.lr)(),e=(0,i.Z)(n,2),r=e[0],t=e[1];return function(n){var e=(0,X.sW)((0,a.Z)((0,a.Z)({},Object.fromEntries(r)),n));return t(e)}},q=function(){var n=H(["name","personId"]),e=(0,i.Z)(n,2),r=e[0],t=e[1];return[(0,o.useMemo)((function(){return(0,a.Z)((0,a.Z)({},r),{},{personId:Number(r.personId)||void 0})}),[r]),t]},_=function(){var n=q();return["projects",(0,i.Z)(n,1)[0]]},G=function(){var n=H(["projectCreate"]),e=(0,i.Z)(n,2),r=e[0].projectCreate,t=e[1],o=H(["editingProjectId"]),a=(0,i.Z)(o,2),u=a[0].editingProjectId,d=a[1],s=W(Number(u)),c=s.data,l=s.isLoading,f=U();return{projectModalOpen:"true"===r||Boolean(u),open:function(){return t({projectCreate:!0})},close:function(){return f({projectCreate:"",editingProjectId:""})},startEdit:function(n){return d({editingProjectId:n})},editingProject:c,isLoading:l}},J=["users"],$=function(n){var e=n.users,r=(0,f.Z)(n,J),t=Y(_()).mutate;return(0,p.jsx)(g.Z,(0,a.Z)({rowKey:"id",pagination:!1,columns:[{title:(0,p.jsx)(O,{checked:!0,disabled:!0}),render:function(n,e){return(0,p.jsx)(O,{checked:e.pin,onCheckChange:(r=e.id,function(n){return t({id:r,pin:n})})});var r}},{title:"\u540d\u79f0",sorter:function(n,e){return n.name.localeCompare(e.name)},render:function(n,e){return(0,p.jsx)(L.rU,{to:String(e.id),children:e.name})}},{title:"\u90e8\u95e8",dataIndex:"organization"},{title:"\u8d1f\u8d23\u4eba",render:function(n,r){var t;return(0,p.jsx)("span",{children:(null===(t=e.find((function(n){return n.id===r.personId})))||void 0===t?void 0:t.name)||"\u672a\u77e5"})}},{title:"\u521b\u5efa\u65f6\u95f4",render:function(n,e){return(0,p.jsx)("span",{children:e.created?C()(e.created).format("YYYY-MM-DD"):"\u65e0"})}},{render:function(n,e){return(0,p.jsx)(nn,{project:e})}}]},r))},nn=function(n){var e=n.project,r=G().startEdit,t=function(n){var e=(0,s.m)();return(0,c.useMutation)((function(n){return e("projects/".concat(n),{method:"DELETE"})}),z(n))}(_()).mutate;return(0,p.jsx)(y.Z,{overlay:(0,p.jsx)(k.Z,{items:[{key:"edit",label:"\u7f16\u8f91",onClick:function(){return n=e.id,r(n);var n}},{key:"del",label:"\u5220\u9664",onClick:function(){return n=e.id,void b.Z.confirm({title:"\u786e\u5b9a\u5220\u9664\u8fd9\u4e2a\u9879\u76ee\u5417\uff1f",content:"\u70b9\u51fb\u786e\u5b9a\u5220\u9664",okText:"\u786e\u5b9a",onOk:function(){t(n)}});var n}}]}),children:(0,p.jsx)(B.zL,{type:"link",children:"..."})})},en=function(){(0,X.jr)("\u9879\u76ee\u5217\u8868",!1);var n=q(),e=(0,i.Z)(n,2),r=e[0],t=e[1],o=(0,X.Nr)(r,200),a=R(o),u=a.isLoading,d=a.error,s=a.data,c=l().data,f=G().open;return(0,p.jsxs)(B._z,{children:[(0,p.jsxs)(B.X2,{between:!0,children:[(0,p.jsx)("h1",{children:"\u9879\u76ee\u5217\u8868"}),(0,p.jsx)(B.zL,{onClick:f,type:"link",children:"\u521b\u5efa\u9879\u76ee"})]}),(0,p.jsx)(Z,{users:c||[],param:r,setParam:t}),(0,p.jsx)(B.Tv,{error:d}),(0,p.jsx)($,{loading:u,dataSource:s||[],users:c||[]})]})};en.whyDidYouRender=!1;var rn=r(9937),tn=r(1824),on=r(7380),an=r(5877),un=r(9425),dn=function(n){var e=(0,s.m)();return(0,c.useQuery)(["kanbans",n],(function(){return e("kanbans",{data:n})}))},sn=function(n){var e=(0,s.m)();return(0,c.useMutation)((function(n){return e("kanbans/reorder",{data:{fromId:n.fromId,referenceId:n.toId,type:n.type},method:"POST"})}),function(n){return F(n,(function(n,e){return N((0,a.Z)({list:e},n))}))}(n))},cn=function(n){var e=(0,s.m)(),r=(0,a.Z)((0,a.Z)({},n),{},{name:(0,X.Nr)(null===n||void 0===n?void 0:n.name,200)});return(0,c.useQuery)(["tasks",r],(function(){return e("tasks",{data:r})}))},ln=function(n){var e=(0,s.m)();return(0,c.useMutation)((function(n){return e("tasks/reorder",{data:{fromId:n.fromId,referenceId:n.toId,type:n.type,fromKanbanId:n.fromKanbanId,toKanbanId:n.toKanbanId},method:"POST"})}),function(n){return F(n,(function(n,e){return N((0,a.Z)({list:e},n)).map((function(e){return e.id===n.fromId?(0,a.Z)((0,a.Z)({},e),{},{kanbanId:n.toKanbanId}):e}))}))}(n))},fn=function(){var n,e=null===(n=(0,un.TH)().pathname.match(/projects\/(\d+)/))||void 0===n?void 0:n[1];return Number(e)},mn=function(){return W(fn())},pn=function(){return{projectId:fn()}},xn=function(){return["kanbans",pn()]},hn=function(){var n=H(["name","typeId","processorId","tagId"]),e=(0,i.Z)(n,1)[0],r=fn();return(0,o.useMemo)((function(){return{projectId:r,typeId:Number(e.typeId)||void 0,processorId:Number(e.processorId)||void 0,tagId:Number(e.tagId)||void 0,name:e.name}}),[r,e])},vn=function(){return["tasks",hn()]},jn=function(){var n=H(["editingTaskId"]),e=(0,i.Z)(n,2),r=e[0].editingTaskId,t=e[1],a=function(n){var e=(0,s.m)();return(0,c.useQuery)(["task",{id:n}],(function(){return e("tasks/".concat(n))}),{enabled:Boolean(n)})}(Number(r)),u=a.data,d=a.isLoading;return{editingTaskId:r,editingTask:u,startEdit:(0,o.useCallback)((function(n){t({editingTaskId:n})}),[t]),close:(0,o.useCallback)((function(){t({editingTaskId:""})}),[t]),isLoading:d}},Zn=function(){var n=(0,s.m)();return(0,c.useQuery)(["taskTypes"],(function(){return n("taskTypes")}))};var gn=r.p+"static/media/task.a48202a2e4220cbed6055f852cd9fe7d.svg";var bn,yn,kn,In,Cn,Ln,wn,En,On,Tn,Mn,Pn,Nn,Sn,An=r.p+"static/media/bug.11605bc8d9f34a587f5918a035730618.svg",Fn=r(4008),zn=function(n){var e=n.kanbanId,r=(0,o.useState)(""),t=(0,i.Z)(r,2),a=t[0],u=t[1],l=function(n){var e=(0,s.m)();return(0,c.useMutation)((function(n){return e("tasks",{data:n,method:"POST"})}),Q(n))}(vn()).mutateAsync,f=fn(),m=(0,o.useState)(!1),x=(0,i.Z)(m,2),h=x[0],v=x[1],j=function(){var n=(0,P.Z)((0,M.Z)().mark((function n(){return(0,M.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l({projectId:f,name:a,kanbanId:e});case 2:v(!1),u("");case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),Z=function(){return v((function(n){return!n}))};return(0,o.useEffect)((function(){h||u("")}),[h]),h?(0,p.jsx)(Fn.Z,{children:(0,p.jsx)(d.Z,{onBlur:Z,placeholder:"\u9700\u8981\u505a\u4e9b\u4ec0\u4e48",autoFocus:!0,onPressEnter:j,value:a,onChange:function(n){return u(n.target.value)}})}):(0,p.jsx)("div",{onClick:Z,children:"+\u521b\u5efa\u4e8b\u52a1"})},Dn=function(n){var e=n.name,r=n.keyword;if(!r)return(0,p.jsx)(p.Fragment,{children:e});var t=e.split(r);return(0,p.jsx)(p.Fragment,{children:t.map((function(n,e){return(0,p.jsxs)("span",{children:[n,e===t.length-1?null:(0,p.jsx)("span",{style:{color:"#257AFD"},children:r})]},e)}))})},Qn=r(4123),Rn=["children"],Yn=["children"],Kn=["children"],Wn=function(n){var e=n.children,r=(0,f.Z)(n,Rn);return(0,p.jsx)(Qn.bK,(0,a.Z)((0,a.Z)({},r),{},{children:function(n){return o.isValidElement(e)?o.cloneElement(e,(0,a.Z)((0,a.Z)({},n.droppableProps),{},{ref:n.innerRef,provided:n})):(0,p.jsx)("div",{})}}))},Bn=o.forwardRef((function(n,e){var r,t=n.children,i=(0,f.Z)(n,Yn);return(0,p.jsxs)("div",(0,a.Z)((0,a.Z)({ref:e},i),{},{children:[t,null===(r=i.provided)||void 0===r?void 0:r.placeholder]}))})),Vn=function(n){var e=n.children,r=(0,f.Z)(n,Kn);return(0,p.jsx)(Qn._l,(0,a.Z)((0,a.Z)({},r),{},{children:function(n){return o.isValidElement(e)?o.cloneElement(e,(0,a.Z)((0,a.Z)((0,a.Z)({},n.draggableProps),n.dragHandleProps),{},{ref:n.innerRef})):(0,p.jsx)("div",{})}}))},Xn=["kanban"],Hn=function(n){var e,r=n.id,t=Zn().data,i=null===t||void 0===t||null===(e=t.find((function(n){return n.id===r})))||void 0===e?void 0:e.name;return i?(0,p.jsx)("img",{src:"task"===i?gn:An,alt:"task-icon"}):null},Un=function(n){var e=n.task,r=jn().startEdit,t=hn().name;return(0,p.jsxs)(Fn.Z,{onClick:function(){return r(e.id)},style:{marginBottom:"0.5rem",cursor:"pointer"},children:[(0,p.jsx)("p",{children:(0,p.jsx)(Dn,{keyword:t,name:e.name})}),(0,p.jsx)(Hn,{id:e.typeId})]},e.id)},qn=o.forwardRef((function(n,e){var r=n.kanban,t=(0,f.Z)(n,Xn),i=cn(hn()).data,o=null===i||void 0===i?void 0:i.filter((function(n){return n.kanbanId===r.id}));return(0,p.jsxs)(Gn,(0,a.Z)((0,a.Z)({},t),{},{ref:e,children:[(0,p.jsxs)(B.X2,{between:!0,children:[(0,p.jsx)("h3",{children:r.name}),(0,p.jsx)(_n,{kanban:r},r.id)]}),(0,p.jsxs)(Jn,{children:[(0,p.jsx)(Wn,{type:"ROW",direction:"vertical",droppableId:String(r.id),children:(0,p.jsx)(Bn,{style:{minHeight:"1rem"},children:null===o||void 0===o?void 0:o.map((function(n,e){return(0,p.jsx)(Vn,{index:e,draggableId:"task"+n.id,children:(0,p.jsx)("div",{children:(0,p.jsx)(Un,{task:n},n.id)})},n.id)}))})}),(0,p.jsx)(zn,{kanbanId:r.id})]})]}))})),_n=function(n){var e=n.kanban,r=function(n){var e=(0,s.m)();return(0,c.useMutation)((function(n){var r=n.id;return e("kanbans/".concat(r),{method:"DELETE"})}),z(n))}(xn()).mutateAsync,t=(0,p.jsx)(k.Z,{items:[{key:"del",label:"\u5220\u9664",onClick:function(){b.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u770b\u677f\u5417",onOk:function(){return r({id:e.id})}})}}]});return(0,p.jsx)(y.Z,{overlay:t,children:(0,p.jsx)(tn.Z,{type:"link",children:"..."})})},Gn=on.Z.div(bn||(bn=(0,t.Z)(["\n  min-width: 27rem;\n  border-radius: 6px;\n  background-color: rgb(244, 245, 247);\n  display: flex;\n  flex-direction: column;\n  padding: 0.7rem 0.7rem 1rem;\n  margin-right: 1.5rem;\n"]))),Jn=on.Z.div(yn||(yn=(0,t.Z)(["\n  overflow: scroll;\n  flex: 1;\n\n  ::-webkit-scrollbar {\n    display: none;\n  }\n"]))),$n=function(n){var e=Zn().data;return(0,p.jsx)(h,(0,a.Z)({options:e||[]},n))},ne=function(){var n=hn(),e=U();return(0,p.jsxs)(B.X2,{marginBottom:4,gap:!0,children:[(0,p.jsx)(d.Z,{style:{width:"20rem"},placeholder:"\u4efb\u52a1\u540d",value:n.name,onChange:function(n){return e({name:n.target.value})}}),(0,p.jsx)(j,{defaultOptionName:"\u7ecf\u529e\u4eba",value:n.processorId,onChange:function(n){e({processorId:n})}}),(0,p.jsx)($n,{defaultOptionName:"\u7c7b\u578b",value:n.typeId,onChange:function(n){return e({typeId:n})}}),(0,p.jsx)(tn.Z,{onClick:function(){e({typeId:void 0,processorId:void 0,tagId:void 0,name:void 0})},children:"\u6e05\u9664\u7b5b\u9009"})]})},ee=r(8415),re=function(){var n=(0,o.useState)(""),e=(0,i.Z)(n,2),r=e[0],t=e[1],a=fn(),u=function(n){var e=(0,s.m)();return(0,c.useMutation)((function(n){return e("kanbans",{data:n,method:"POST"})}),Q(n))}(xn()).mutateAsync,l=function(){var n=(0,P.Z)((0,M.Z)().mark((function n(){return(0,M.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u({name:r,projectId:a});case 2:t("");case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,p.jsx)(Gn,{children:(0,p.jsx)(d.Z,{size:"large",placeholder:"\u65b0\u5efa\u770b\u677f\u540d\u79f0",onPressEnter:l,value:r,onChange:function(n){return t(n.target.value)}})})},te=r(4113),ie={labelCol:{span:9},wrapperCol:{span:16}},oe=function(){var n=(0,te.Z)(),e=(0,i.Z)(n,1)[0],r=jn(),t=r.editingTaskId,l=r.editingTask,f=r.close,m=function(n){var e=(0,s.m)();return(0,c.useMutation)((function(n){return e("tasks/".concat(n.id),{method:"PATCH",data:n})}),D(n))}(vn()),x=m.mutateAsync,h=m.isLoading,v=function(n){var e=(0,s.m)();return(0,c.useMutation)((function(n){var r=n.id;return e("tasks/".concat(r),{method:"DELETE"})}),z(n))}(vn()).mutateAsync,Z=function(){var n=(0,P.Z)((0,M.Z)().mark((function n(){return(0,M.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,x((0,a.Z)((0,a.Z)({},l),e.getFieldsValue()));case 2:f();case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return(0,o.useEffect)((function(){e.setFieldsValue(l)}),[e,l]),(0,p.jsxs)(b.Z,{forceRender:!0,onOk:Z,onCancel:function(){f(),e.resetFields()},okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",confirmLoading:h,title:"\u7f16\u8f91\u4efb\u52a1",visible:!!t,children:[(0,p.jsxs)(u.Z,(0,a.Z)((0,a.Z)({},ie),{},{initialValues:l,form:e,children:[(0,p.jsx)(u.Z.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}],children:(0,p.jsx)(d.Z,{})}),(0,p.jsx)(u.Z.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId",children:(0,p.jsx)(j,{defaultOptionName:"\u7ecf\u529e\u4eba"})}),(0,p.jsx)(u.Z.Item,{label:"\u7c7b\u578b",name:"typeId",children:(0,p.jsx)($n,{})})]})),(0,p.jsx)("div",{style:{textAlign:"right"},children:(0,p.jsxs)(tn.Z,{onClick:function(){f(),b.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u4efb\u52a1\u5417",onOk:function(){return v({id:Number(t)})}})},style:{fontSize:"14px"},size:"small",children:[" ","\u5220\u9664"]})})]})},ae=function(){(0,X.jr)("\u770b\u677f\u5217\u8868");var n=mn().data,e=dn(pn()),r=e.data,t=e.isLoading,i=cn(hn()).isLoading,o=t||i,a=de();return(0,p.jsx)(Qn.Z5,{onDragEnd:a,children:(0,p.jsxs)(B._z,{children:[(0,p.jsxs)("h1",{children:[null===n||void 0===n?void 0:n.name,"\u770b\u677f"]}),(0,p.jsx)(ne,{}),o?(0,p.jsx)(ee.Z,{size:"large"}):(0,p.jsxs)(ue,{children:[(0,p.jsx)(Wn,{type:"COLUMN",direction:"horizontal",droppableId:"kanban",children:(0,p.jsx)(Bn,{style:{display:"flex"},children:null===r||void 0===r?void 0:r.map((function(n,e){return(0,p.jsx)(Vn,{draggableId:"kanban"+n.id,index:e,children:(0,p.jsx)(qn,{kanban:n},n.id)},n.id)}))})}),(0,p.jsx)(re,{})]}),(0,p.jsx)(oe,{})]})})},ue=on.Z.div(kn||(kn=(0,t.Z)(["\n  display: flex;\n  overflow-x: scroll;\n  flex: 1;\n"]))),de=function(){var n=dn(pn()).data,e=sn(xn()).mutate,r=ln(vn()).mutate,t=cn(hn()).data,i=void 0===t?[]:t;return(0,o.useCallback)((function(t){var o=t.source,a=t.destination,u=t.type;if(a){if("COLUMN"===u){var d=null===n||void 0===n?void 0:n[o.index].id,s=null===n||void 0===n?void 0:n[a.index].id;if(!d||!s||d===s)return;var c=a.index>o.index?"after":"before";e({fromId:d,toId:s,type:c})}if("ROW"===u){var l=+o.droppableId,f=+a.droppableId,m=i.filter((function(n){return n.kanbanId===l}))[o.index],p=i.filter((function(n){return n.kanbanId===f}))[a.index];if((null===m||void 0===m?void 0:m.id)===(null===p||void 0===p?void 0:p.id))return;r({fromId:null===m||void 0===m?void 0:m.id,toId:null===p||void 0===p?void 0:p.id,fromKanbanId:l,toKanbanId:f,type:a.index>o.index?"after":"before"})}}}),[n,e,i,r])},se=function(){return{projectId:fn()}},ce=function(){return["epics",se()]},le=r(8760),fe=r(1689),me=function(){var n=G(),e=n.projectModalOpen,r=n.close,t=n.editingProject,s=n.isLoading,c=(t?Y:K)(_()),l=c.mutateAsync,f=c.error,m=c.isLoading,x=(0,te.Z)(),h=(0,i.Z)(x,1)[0],v=t?"\u7f16\u8f91\u9879\u76ee":"\u521b\u5efa\u9879\u76ee";return(0,o.useEffect)((function(){h.setFieldsValue(t)}),[t,h]),(0,p.jsx)(fe.Z,{forceRender:!0,onClose:function(){h.resetFields(),r()},visible:e,width:"100%",children:(0,p.jsx)(pe,{children:s?(0,p.jsx)(ee.Z,{size:"large"}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("h1",{children:v}),(0,p.jsx)(B.Tv,{error:f}),(0,p.jsxs)(u.Z,{form:h,layout:"vertical",style:{width:"40rem"},onFinish:function(n){l((0,a.Z)((0,a.Z)({},t),n)).then((function(){h.resetFields(),r()}))},children:[(0,p.jsx)(u.Z.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d"}],children:(0,p.jsx)(d.Z,{placeholder:"\u8bf7\u8f93\u5165\u9879\u76ee\u540d"})}),(0,p.jsx)(u.Z.Item,{label:"\u90e8\u95e8",name:"organization",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d"}],children:(0,p.jsx)(d.Z,{placeholder:"\u8bf7\u8f93\u5165\u90e8\u95e8\u540d"})}),(0,p.jsx)(u.Z.Item,{label:"\u8d1f\u8d23\u4eba",name:"personId",children:(0,p.jsx)(j,{defaultOptionName:"\u8d1f\u8d23\u4eba"})}),(0,p.jsx)(u.Z.Item,{style:{textAlign:"right"},children:(0,p.jsx)(tn.Z,{loading:m,type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})]})})})},pe=on.Z.div(In||(In=(0,t.Z)(["\n  flex-direction: column;\n  height: 80vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"]))),xe=function(n){var e=function(n){var e=(0,s.m)();return(0,c.useMutation)((function(n){return e("epics",{data:n,method:"POST"})}),Q(n))}(ce()),r=e.mutate,t=e.isLoading,l=e.error,f=(0,te.Z)(),m=(0,i.Z)(f,1)[0],x=fn(),h=function(){var e=(0,P.Z)((0,M.Z)().mark((function e(t){return(0,M.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r((0,a.Z)((0,a.Z)({},t),{},{projectId:x}));case 2:n.onClose();case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){m.resetFields()}),[m,n.visible]),(0,p.jsx)(fe.Z,{visible:n.visible,onClose:n.onClose,forceRender:!0,destroyOnClose:!0,width:"100%",children:(0,p.jsxs)(pe,{children:[(0,p.jsx)("h1",{children:"\u521b\u5efa\u4efb\u52a1\u7ec4"}),(0,p.jsx)(B.Tv,{error:l}),(0,p.jsxs)(u.Z,{form:m,layout:"vertical",style:{width:"40rem"},onFinish:h,children:[(0,p.jsx)(u.Z.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d"}],children:(0,p.jsx)(d.Z,{placeholder:"\u8bf7\u8f93\u5165\u4efb\u52a1\u7ec4\u540d"})}),(0,p.jsx)(u.Z.Item,{style:{textAlign:"right"},children:(0,p.jsx)(tn.Z,{loading:t,type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})]})})},he=function(){(0,X.jr)("\u4efb\u52a1\u7ec4");var n=mn().data,e=function(n){var e=(0,s.m)();return(0,c.useQuery)(["epics",n],(function(){return e("epics",{data:n})}))}(se()).data,r=cn({projectId:null===n||void 0===n?void 0:n.id}).data,t=function(n){var e=(0,s.m)();return(0,c.useMutation)((function(n){var r=n.id;return e("epics/".concat(r),{method:"DELETE"})}),z(n))}(ce()).mutate,a=(0,o.useState)(!1),u=(0,i.Z)(a,2),d=u[0],l=u[1];return(0,p.jsxs)(B._z,{children:[(0,p.jsxs)(B.X2,{between:!0,children:[(0,p.jsxs)("h1",{children:[null===n||void 0===n?void 0:n.name,"\u4efb\u52a1\u7ec4"]}),(0,p.jsx)(tn.Z,{type:"link",onClick:function(){return l(!0)},children:"\u521b\u5efa\u4efb\u52a1\u7ec4"})]}),(0,p.jsx)(le.ZP,{style:{overflow:"scroll"},dataSource:e,itemLayout:"vertical",renderItem:function(e){return(0,p.jsxs)(le.ZP.Item,{children:[(0,p.jsx)(le.ZP.Item.Meta,{title:(0,p.jsxs)(B.X2,{between:!0,children:[(0,p.jsx)("span",{children:e.name}),(0,p.jsx)(tn.Z,{type:"link",onClick:function(){return n=null===e||void 0===e?void 0:e.id,void b.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u770b\u677f\u5417",onOk:function(){return t({id:n})}});var n},children:"\u5220\u9664"})]}),description:(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{children:["\u5f00\u59cb\u65f6\u95f4\uff1a",C()(e.start).format("YYYY-MM-DD")]}),(0,p.jsxs)("div",{children:["\u7ed3\u675f\u65f6\u95f4\uff1a",C()(e.end).format("YYYY-MM-DD")]})]})}),(0,p.jsx)("div",{children:null===r||void 0===r?void 0:r.filter((function(n){return n.epicId===e.id})).map((function(e){return(0,p.jsx)("p",{children:(0,p.jsx)(L.rU,{to:"/projects/".concat(null===n||void 0===n?void 0:n.id,"/kanban?editingTaskId=").concat(e.id),children:e.name},e.id)})}))})]},e.id)}}),(0,p.jsx)(xe,{onClose:function(){return l(!1)},visible:d})]})},ve=function(){var n=function(){var n=(0,un.TH)().pathname.split("/");return n[n.length-1]}();return(0,p.jsxs)(ge,{children:[(0,p.jsx)(je,{children:(0,p.jsx)(k.Z,{mode:"inline",selectedKeys:[n],items:[{key:"kanban",label:(0,p.jsx)(L.rU,{to:"kanban",children:"\u770b\u677f"})},{key:"epic",label:(0,p.jsx)(L.rU,{to:"epic",children:"\u4efb\u52a1\u7ec4"})}]})}),(0,p.jsx)(Ze,{children:(0,p.jsxs)(un.Z5,{children:[(0,p.jsx)(un.AW,{path:"/kanban",element:(0,p.jsx)(ae,{})}),(0,p.jsx)(un.AW,{path:"/epic",element:(0,p.jsx)(he,{})}),(0,p.jsx)(un.AW,{path:"*",element:(0,p.jsx)(un.Fg,{to:"kanban",replace:!0})})]})})]})},je=on.Z.aside(Cn||(Cn=(0,t.Z)(["\n  background-color: rgb(244, 245, 247);\n  display: flex;\n"]))),Ze=on.Z.main(Ln||(Ln=(0,t.Z)(["\n  box-shadow: -5px 0 5px -5px rgba(0, 0, 0, 0.1);\n  display: flex;\n  // \u9632\u6b62\u5411\u5916\u4f38\u5c55\n  overflow: hidden;\n"]))),ge=on.Z.div(wn||(wn=(0,t.Z)(["\n  display: grid;\n  grid-template-columns: 16rem 1fr;\n  overflow: hidden;\n  width: 100%;\n"]))),be=r(9502),ye=r(5508),ke=r(1242),Ie=function(){var n=R(),e=n.data,r=n.refetch,t=null===e||void 0===e?void 0:e.filter((function(n){return n.pin})),i=G().open,o=(0,p.jsxs)(Ce,{children:[(0,p.jsx)(be.Z.Text,{type:"secondary",children:"\u6536\u85cf\u9879\u76ee"}),(0,p.jsx)(le.ZP,{children:null===t||void 0===t?void 0:t.map((function(n){return(0,p.jsx)(le.ZP.Item,{children:(0,p.jsx)(le.ZP.Item.Meta,{title:n.name})},n.id)}))}),(0,p.jsx)(ye.Z,{}),(0,p.jsx)(B.zL,{onClick:i,type:"link",children:"\u521b\u5efa\u9879\u76ee"})]});return(0,p.jsx)(ke.Z,{onVisibleChange:function(){return r()},placement:"bottom",content:o,children:(0,p.jsx)("span",{children:"\u9879\u76ee"})})},Ce=on.Z.div(En||(En=(0,t.Z)(["\n  min-width: 30rem;\n"]))),Le=function(){var n=l(),e=n.data,r=n.refetch,t=(0,p.jsxs)(we,{children:[(0,p.jsx)(be.Z.Text,{type:"secondary",children:"\u7ec4\u5458\u5217\u8868"}),(0,p.jsx)(le.ZP,{children:null===e||void 0===e?void 0:e.map((function(n){return(0,p.jsx)(le.ZP.Item,{children:(0,p.jsx)(le.ZP.Item.Meta,{title:n.name})},n.id)}))}),(0,p.jsx)(ye.Z,{})]});return(0,p.jsx)(ke.Z,{onVisibleChange:function(){return r()},placement:"bottom",content:t,children:(0,p.jsx)("span",{children:"\u7ec4\u5458"})})},we=on.Z.div(On||(On=(0,t.Z)(["\n  min-width: 30rem;\n"]))),Ee=function(){return(0,p.jsx)(Me,{children:(0,p.jsxs)(L.VK,{basename:"/aJira",children:[(0,p.jsx)(Oe,{}),(0,p.jsx)(Ae,{children:(0,p.jsxs)(un.Z5,{children:[(0,p.jsx)(un.AW,{path:"/projects",element:(0,p.jsx)(en,{})}),(0,p.jsx)(un.AW,{path:"/projects/:projectId/*",element:(0,p.jsx)(ve,{})}),(0,p.jsx)(un.AW,{path:"*",element:(0,p.jsx)(un.Fg,{to:"/projects"})})]})}),(0,p.jsx)(me,{})]})})},Oe=function(){return(0,p.jsxs)(Pe,{between:!0,children:[(0,p.jsxs)(Ne,{gap:!0,children:[(0,p.jsx)(B.zL,{type:"link",onClick:X.Xj,children:(0,p.jsx)(an.r,{width:"10rem",height:"3rem"})}),(0,p.jsx)(Ie,{}),(0,p.jsx)(Le,{})]}),(0,p.jsx)(Se,{children:(0,p.jsx)(Te,{})})]})},Te=function(){var n=(0,rn.a)(),e=n.logout,r=n.user;return(0,p.jsx)(y.Z,{overlay:(0,p.jsx)(k.Z,{children:(0,p.jsx)(k.Z.Item,{children:(0,p.jsx)(tn.Z,{type:"link",onClick:e,children:"\u767b\u51fa"})},"logout")}),children:(0,p.jsxs)(tn.Z,{type:"link",onClick:function(n){return n.preventDefault()},children:[" ","Hi, ",null===r||void 0===r?void 0:r.name]})})},Me=on.Z.div(Tn||(Tn=(0,t.Z)(["\n  display: grid;\n  grid-template-rows: 6rem 1fr;\n  height: 100vh;\n"]))),Pe=(0,on.Z)(B.X2)(Mn||(Mn=(0,t.Z)(["\n  padding: 3.2rem;\n  box-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.1);\n  z-index: 1;\n"]))),Ne=(0,on.Z)(B.X2)(Pn||(Pn=(0,t.Z)([""]))),Se=on.Z.div(Nn||(Nn=(0,t.Z)([""]))),Ae=on.Z.main(Sn||(Sn=(0,t.Z)(["\n  display: flex;\n  overflow: hidden;\n"])))}}]);
//# sourceMappingURL=103.4249e648.chunk.js.map